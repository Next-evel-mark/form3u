<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>𝐓𝐇𝐄𝐄 𝐔 𝐂𝐇𝐑𝐎𝐍𝐈𝐂𝐋𝐄𝐒</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
<style>
  :root{
    --bg:#0f1724;
    --card:#0b1220;
    --accent:#8b5cf6;
    --muted:#94a3b8;
    --glass: rgba(255,255,255,0.03);
    --glass-2: rgba(255,255,255,0.02);
  }
  *{box-sizing:border-box}
  body{
    margin:0;
    font-family:Inter,system-ui,Segoe UI,Roboto,"Helvetica Neue",Arial;
    background: linear-gradient(180deg, #071025 0%, #071b2a 60%);
    color:#e6eef8;
    -webkit-font-smoothing:antialiased;
    -moz-osx-font-smoothing:grayscale;
    padding:24px;
  }
  .topbar{
    display:flex;
    gap:12px;
    align-items:center;
    justify-content:space-between;
    margin-bottom:18px;
  }
  .title-box{
    display:flex;
    flex-direction:column;
    gap:6px;
  }
  h1{
    margin:0;
    letter-spacing:6px;
    font-weight:800;
    font-size:28px;
    line-height:1;
    color:var(--accent);
    text-shadow: 0 6px 24px rgba(139,92,246,0.12);
  }
  .subtitle{
    color:var(--muted);
    font-size:13px;
  }
  .subtitle a{ color:#fff; font-weight:600; text-decoration:none; }
  .subtitle a:hover{ text-decoration:underline; }
  .controls{
    display:flex;
    gap:10px;
    align-items:center;
  }
  .btn{
    background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    border:1px solid rgba(255,255,255,0.04);
    padding:8px 12px;
    border-radius:12px;
    color:#eaf2ff;
    cursor:pointer;
    font-weight:600;
    display:inline-flex;
    gap:8px;
    align-items:center;
  }
  .btn:active{ transform:translateY(1px); }
  .layout{
    display:grid;
    grid-template-columns: 320px 1fr;
    gap:20px;
  }
  @media (max-width:900px){ .layout{ grid-template-columns:1fr; } }
  .card{
    background:linear-gradient(180deg,var(--card), #071020);
    border-radius:14px;
    padding:16px;
    box-shadow: 0 6px 30px rgba(3,7,18,0.6);
    border:1px solid rgba(255,255,255,0.02);
  }
  .toc a{
    display:block;
    padding:10px;
    border-radius:10px;
    color:var(--muted);
    text-decoration:none;
    margin-bottom:8px;
  }
  .toc a:hover{ background:var(--glass); color:#fff; }
  .section{
    margin-bottom:18px;
  }
  .section h2{
    margin:0 0 12px 0;
    font-size:18px;
    color:#fff;
    display:flex;
    align-items:center;
    gap:10px;
  }
  .member-grid{
    display:grid;
    grid-template-columns: repeat(auto-fit,minmax(150px,1fr));
    gap:10px;
  }
  .member{
    background:var(--glass-2);
    padding:10px;
    border-radius:10px;
    display:flex;
    gap:10px;
    align-items:center;
    border:1px solid rgba(255,255,255,0.02);
  }
  .avatar{
    width:44px;height:44px;border-radius:10px;
    display:inline-grid;place-items:center;font-size:20px;
    background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    border:1px solid rgba(255,255,255,0.03);
  }
  .name{ font-weight:700; font-size:14px;  }
  .muted{ color:var(--muted); font-size:13px; }
  .ig-list{ display:grid; gap:8px; }
  .ig-item{
    display:flex; gap:10px; align-items:center; padding:8px; border-radius:10px;
    background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.005));
  }
  .ig-badge{ width:40px; height:40px; display:grid; place-items:center; border-radius:50%; font-weight:800; border:1px solid rgba(255,255,255,0.03); }
  .small{ font-size:12px; color:var(--muted); margin-top:6px; }
  .settings-panel{
    position:fixed; left:18px; top:18px; transform:translateY(0);
    background:linear-gradient(180deg,#05101a,#071423); padding:12px; border-radius:10px; z-index:60;
    border:1px solid rgba(255,255,255,0.03); box-shadow: 0 10px 30px rgba(3,7,18,0.7);
  }
  .hidden{ display:none; }
  .edit-toolbar{ display:flex; gap:6px; flex-wrap:wrap; margin-bottom:8px; }
  textarea, input[type="text"]{ width:100%; padding:8px; border-radius:8px; border:1px solid rgba(255,255,255,0.03); background:transparent; color:#eaf2ff; }
  .save-note{ font-size:12px; color:var(--muted); margin-top:8px; }
  footer{ margin-top:20px; color:var(--muted); font-size:13px; text-align:center; }
  a.ig-link{ color:#e6eef8; text-decoration:none; font-weight:700;}
  .counter{ font-weight:700; color:var(--accent); padding:6px 10px; border-radius:8px; background:rgba(139,92,246,0.06); }
</style>
</head>
<body>

<div class="topbar">
  <div class="title-box">
    <h1>𝐓𝐇𝐄𝐄 𝐔 𝐂𝐇𝐑𝐎𝐍𝐈𝐂𝐋𝐄𝐒</h1>
    <div class="subtitle" id="subtitle" data-default="Developed by 𝕸𝖆𝖗𝖐 under 𝕳𝖆𝖗𝖑𝖔𝖜 and 𝕸𝖆𝖗𝖈𝖊𝖑'𝖘 Instruction">
      Developed by
      <a href="https://instagram.com/next_level_mark" target="_blank" id="link-mark">𝕸𝖆𝖗𝖐</a>
      under
      <a href="https://instagram.com/har.*.low" target="_blank" id="link-harlow">𝕳𝖆𝖗𝖑𝖔𝖜</a>
      and
      <a href="https://instagram.com/mar.c.e.l_" target="_blank" id="link-marcel">𝕸𝖆𝖗𝖈𝖊𝖑</a>
      's Instruction
    </div>
  </div>

  <div class="controls">
    <div class="counter" id="visitCount">Visits: ...</div>
    <button class="btn" id="settingsBtn" title="Settings (password protected)">
      ⚙️ Settings
    </button>
    <button class="btn" id="gotoTop" title="Back to top">⬆️ Top</button>
  </div>
</div>

<div class="layout">
  <!-- LEFT: Table of contents -->
  <aside class="card">
    <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:10px">
      <strong style="font-size:15px">Table of contents</strong>
      <span class="small">Jump to section</span>
    </div>
    <nav class="toc" id="toc">
      <a href="#members">1. Members</a>
      <a href="#teachers">2. Teachers</a>
      <a href="#nicknames">3. Nicknames</a>
      <a href="#insta">4. Instagram accounts</a>
      <a href="#classgees">5. Class Gees</a>
      <a href="#keythings">6. Key things F3</a>
      <a href="#memes">7. Class memes</a>
      <a href="#backbench">8. Back bencher's Desk</a>
      <a href="#about">9. About Mark, Harlow and Marcel</a>
    </nav>

    <div style="margin-top:12px;">
      <strong class="small">Note</strong>
      <div class="small" style="margin-top:6px">Editing requires password <code>MATRIX</code>. Edits are saved locally (your browser).</div>
    </div>
  </aside>

  <!-- RIGHT: Main content -->
  <main>
    <section id="members" class="card section" data-key="membersContent">
      <h2>1. Class Members</h2>
      <div class="member-grid" id="membersGrid">
        <!-- Members inserted by JS -->
      </div>
    </section>

    <section id="teachers" class="card section" data-key="teachersContent">
      <h2>2. Teachers</h2>
      <div class="member-grid" id="teachersGrid"></div>
    </section>

    <section id="nicknames" class="card section" data-key="nicknamesContent">
      <h2>3. Nicknames</h2>
      <div id="nickList"></div>
    </section>

    <section id="insta" class="card section" data-key="instaContent">
      <h2>4. Instagram accounts</h2>
      <div class="ig-list" id="igList"></div>
    </section>

    <section id="classgees" class="card section" data-key="classgeesContent">
      <h2>5. Class Gees</h2>
      <p class="muted">(Placeholder) — add favorite class chants, slogans or inside jokes here. Editable via Settings.</p>
    </section>

    <section id="keythings" class="card section" data-key="keythingsContent">
      <h2>6. Key things F3</h2>
      <p class="muted">(Placeholder)</p>
    </section>

    <section id="memes" class="card section" data-key="memesContent">
      <h2>7. Class memes</h2>
      <p class="muted">(Placeholder)</p>
    </section>

    <section id="backbench" class="card section" data-key="backbenchContent">
      <h2>8. Back bencher's Desk</h2>
      <p class="muted">(Placeholder)</p>
    </section>

    <section id="about" class="card section" data-key="aboutContent">
      <h2>9. About Mark, Harlow and Marcel</h2>
      <p class="muted">This project was created by the class. Click the Instagram names in the header to open their profiles.</p>
    </section>

    <footer class="card" style="margin-top:18px">
      <div>Made with 💜 • <span id="visitorNote">Visitor counter per browser (local)</span></div>
      <div class="small" style="margin-top:8px">Tip: use Settings → Edit mode (password MATRIX) to edit any section directly on this page.</div>
    </footer>
  </main>
</div>

<!-- SETTINGS PANEL -->
<div id="settingsPanel" class="settings-panel hidden" aria-hidden="true">
  <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
    <strong>Settings</strong>
    <button id="closeSettings" class="btn" style="padding:6px 8px">✖</button>
  </div>

  <div id="pwBox">
    <label class="small">Enter password to unlock editing:</label>
    <input id="pwInput" type="text" placeholder="Password" />
    <div style="display:flex;gap:8px;margin-top:8px">
      <button id="pwUnlock" class="btn">Unlock</button>
      <button id="pwCancel" class="btn">Cancel</button>
    </div>
    <div id="pwMessage" class="small" style="margin-top:8px;color:var(--muted)"></div>
  </div>

  <div id="editBox" class="hidden">
    <div class="edit-toolbar">
      <button id="toggleEdit" class="btn">Enable Edit Mode</button>
      <button id="saveEdits" class="btn">Save Edits</button>
      <button id="revertEdits" class="btn">Revert to Original</button>
      <button id="clearLocal" class="btn">Clear Saved Edits</button>
    </div>

    <div class="small">Edit sections directly on the page. When "Edit Mode" is ON, sections become editable. Use Save Edits to persist to this browser.</div>
  </div>
</div>

<script>
/* ======== Data ======== */
const membersArr = [
"𝐕𝐢𝐜𝐭𝐨𝐫","𝐃𝐚𝐧𝐳𝐚","𝐊𝐞𝐟𝐟𝐚","𝐂𝐞𝐞-𝐤𝐚𝐲","𝐂𝐡𝐞𝐬𝐢𝐧𝐞𝐧","𝐋𝐢𝐨𝐧𝐞𝐥","𝐉𝐚𝐭𝐞𝐥𝐨","𝐀𝐧𝐭𝐨","𝐑𝐚𝐦𝐬𝐞𝐲","𝐁𝐚𝐫𝐨𝐝𝐚",
"𝐌𝐚𝐫𝐜𝐞𝐥𝐨","𝐎𝐥𝐢𝐧𝐠𝐚","𝐎𝐥𝐢𝐧𝐝𝐚","𝐇𝐚𝐫𝐥𝐨𝐰","𝐁𝐞𝐭𝐡𝐮𝐞𝐥","𝐃𝐫.𝐌𝐚𝐭𝐭𝐢","𝐀𝐧𝐲𝐚𝐧𝐠𝐚","𝐊𝐢𝐫𝐤","𝐍𝐚𝐤𝐢𝐭𝐚𝐫𝐞","𝐒𝐡𝐚𝐰𝐧",
"𝐌𝐰𝐞𝐧𝐝𝐰𝐚","𝐕𝐢𝐜𝐭𝐨𝐫","𝐃𝐢𝐬𝐦𝐮𝐬","𝐓𝐫𝐞𝐯𝐨𝐫","𝐁𝐞𝐣𝐚𝐡","𝐋𝐮𝐤𝐮𝐬𝐢","𝐖𝐚𝐲𝐧𝐞","𝐑𝐨𝐛𝐢𝐧","𝐊𝐢𝐧𝐨𝐭𝐢","𝐆𝐚𝐛𝐮",
"𝐃𝐚𝐩𝐚𝐬𝐡","𝐀𝐧𝐚𝐚𝐧","𝐊𝐡𝐢𝐬𝐚","𝐑𝐨𝐫𝐨","𝐓𝐚𝐧𝐮𝐢","𝐌𝐚𝐫𝐤","𝐁𝐮𝐫𝐚𝐥𝐞","𝐁𝐢𝐝𝐞𝐧","𝐀𝐯𝐞𝐝𝐢","𝐏𝐮𝐫𝐯𝐞𝐥",
"𝐀𝐥𝐮𝐤𝐰𝐞","𝐀𝐭𝐡𝐮𝐦𝐚𝐧","𝐀𝐛𝐝𝐢","𝐎𝐰𝐞𝐧","𝐓𝐫𝐞𝐯𝐨𝐫","𝐏𝐞𝐭𝐞𝐫","𝐊𝐢𝐩𝐭𝐨𝐨","𝐄𝐦𝐚𝐜𝐡","𝐒𝐭𝐚𝐧𝐧𝐨","𝐉𝐨𝐛"
];

const teachersArr = [
"𝗠𝗿.𝗪𝗮𝗻𝗱𝗮","𝗺𝗿𝘀.𝗟𝗶𝗹𝗶𝗮𝗻","𝗠𝗿𝘀.𝗪𝗮𝗯𝘄𝗶𝗹𝗲","𝗠𝗿.𝗘𝗿𝗶𝗰","𝗠𝗿.𝗟𝘂𝗸𝗼𝗿𝗶𝘁𝗼","𝗠𝗿.𝗡𝘆𝗼𝗻𝗴𝗲𝘀𝗮","𝗠𝗿.𝗔𝗻𝗻𝗮𝗻","𝗠𝗿.𝗞𝗶𝘁𝘂𝘆𝗶","𝗠𝗿.𝗞𝗮𝘀𝗶𝗹𝗶","𝗠𝗿.𝗝𝗼𝘀𝗶𝗮𝗵"
];

const nicknamesArr = [
"𝐕𝐢𝐜𝐭𝐨𝐫 — 𝐖𝐚𝐣𝐚𝐤𝐨𝐲𝐚",
"𝐙𝐚𝐰𝐚𝐝𝐢 — 𝐃𝐚𝐧𝐳𝐚",
"𝐂𝐞𝐜𝐢𝐥 — 𝐌𝐫.𝐂 𝐤𝐚𝐲",
"𝐂𝐡𝐞𝐬𝐢𝐧𝐞𝐧 — 𝐁𝐥𝐮𝐞 𝐛𝐥𝐚𝐜𝐤",
"𝐋𝐢𝐨𝐧𝐞𝐥 — 𝐂𝐡𝐢𝐞𝐟",
"𝐉𝐚𝐭𝐞𝐥𝐨 — 𝐉𝐚𝐭𝐳𝐳",
"𝐀𝐧𝐭𝐨 — 𝐊𝐨𝐤𝐨𝐭𝐨",
"𝐑𝐚𝐦𝐬𝐞𝐲 — 𝐃𝐨𝐠𝐠𝐲",
"𝐒𝐚𝐦𝐮𝐞𝐥 — 𝐁𝐚𝐫𝐨𝐝𝐚",
"𝐊𝐡𝐢𝐬𝐚 — 𝐖𝐡𝐢𝐭𝐥𝐲",
"𝐃𝐚𝐦𝐢𝐚𝐧 — 𝐌𝐚𝐫𝐜𝐞𝐥",
"𝐎𝐥𝐢𝐧𝐠𝐚 — 𝐒𝐡𝐨𝐫𝐭 𝐦𝐚𝐧",
"𝐉𝐚𝐜𝐤 — 𝐇𝐚𝐫𝐥𝐨𝐰",
"𝐁𝐞𝐭𝐡𝐮𝐞𝐥 — 𝐦𝐚𝐭𝐚𝐤𝐰𝐞𝐢",
"𝐑𝐨𝐲𝐦𝐨𝐧𝐝 — 𝐃𝐫.𝐌𝐚𝐭𝐭𝐫𝐞𝐬𝐬",
"𝐊𝐢𝐫𝐤 — 𝐋𝐚𝐥𝐞",
"𝐍𝐚𝐤𝐢𝐭𝐚𝐫𝐞 — 𝐍𝐚𝐤𝐢",
"𝐒𝐡𝐚𝐰𝐧 𝐤𝐢𝐠𝐞𝐧 — 𝐅𝐚𝐭𝐭𝐲",
"𝐕𝐢𝐜𝐭𝐨𝐫 (𝐥𝐢𝐠𝐡𝐭𝐬𝐤𝐢𝐧) — 𝐎𝐭𝐢𝐬",
"𝐃𝐢𝐬𝐦𝐮𝐬 — 𝐓𝐢𝐭𝐢𝐦𝐚",
"𝐓𝐫𝐞𝐯𝐨𝐫 — √𝐬𝐪𝐮𝐫𝐞 𝐫𝐨𝐨𝐭, 𝐚𝐭𝐨𝐦",
"𝐁𝐞𝐣𝐚𝐡 — 𝐅𝐫𝐞𝐞 𝐦𝐚𝐧",
"𝐒𝐢𝐦𝐢𝐲𝐮 — 𝐌𝐮𝐬𝐮𝐧𝐝𝐢",
"𝐊𝐨𝐥𝐨𝐥𝐢 — 𝐂𝐨𝐜𝐤𝐬",
"𝐑𝐨𝐛𝐢 — 𝐖𝐡𝐢𝐭𝐞 𝐛𝐨𝐲",
"𝐊𝐢𝐧𝐢𝐭𝐢 — 𝐌𝐂𝐀",
"𝐆𝐚𝐛𝐮 — 𝐊𝐚𝐩𝐮",
"𝐃𝐚𝐩𝐚𝐬𝐡 — 𝐖𝐨𝐫𝐢𝐚",
"𝐀𝐧𝐧𝐚𝐧 — 𝐃𝐫.𝐤𝐨𝐟𝐟𝐢",
"𝐊𝐡𝐢𝐬𝐚 — 𝐒𝐚𝐤𝐚",
"𝐌𝐞𝐬𝐡𝐚𝐜𝐤 — 𝐓𝐚𝐣𝐢𝐫𝐢",
"𝐌𝐚𝐫𝐤(𝐰𝐚 𝐜𝐮) — 𝐋𝐢𝐠𝐡𝐭 𝐬𝐤𝐢𝐧",
"𝐌𝐚𝐫𝐤 (𝐨𝐟𝐟𝐢𝐜𝐢𝐚𝐥) — 𝐃𝐞𝐬𝐭𝐢𝐧𝐲😂😂"
];

const igAccounts = [
  {display:"Marcel", handle:"mar.c.e.l_"},
  {display:"Jack / Harlow", handle:"har.*.low"},
  {display:"Mark", handle:"next_level_mark"},
  {display:"Lionel", handle:"Bra.i.niac"},
  {display:"Jatelo", handle:"s.*.a.*.i.*.n.*.t"},
  {display:"Biden", handle:"Holy_sinn.er234"},
  {display:"Ceekay (1)", handle:"ckaynation.ke"},
  {display:"Ceekay (2)", handle:"cee.kay.official."},
  {display:"Khisa", handle:"wheatly77"},
  {display:"Keffa", handle:"mad_pandar"},
  {display:"Avedi", handle:"kid_mysterio"},
  {display:"Gabu", handle:"Am_clean_guyz"},
  {display:"Yeko", handle:"Roony_icyyy"},
  {display:"Amwayi", handle:"elly_antos"},
  {display:"Bad.boy G.", handle:"Goshen"},
  {display:"Wayne", handle:"johnstone_coax"},
  {display:"Baroda", handle:"prime_fantasy"},
  {display:"Ezra", handle:"e_z_r_a3594"},
  {display:"jay d", handle:"v.a.l.d.e.z"},
  {display:"Henry", handle:"Toxic*.icy"},
  {display:"Annan", handle:"Hood_nigga46"},
  {display:"Bonwel", handle:"*kibet_bonwel*"},
  {display:"Robi", handle:"freeky_.robin"},
  {display:"Meshack", handle:"Brad_st.ar"},
  {display:"Craig", handle:"*yxng.ow3n"},
  {display:"Brantany", handle:"brantany.bread"},
  {display:"sikoo", handle:"sikoo_finest.bg"},
  {display:"Mwendwa", handle:"tim.drk_ray"},
  {display:"Gripheen", handle:"wrld.of.Gripheen"},
  {display:"Naki", handle:"Toxic*.jaba"},
  {display:"Kololi", handle:"waynebaraka"},
  {display:"Ramsey", handle:"_.carsoninho"}
];

/* ======== Helpers ======== */
const cycleEmojis = ["😀","😎","🦁","🤖","🧠","🫧","🔥","🌟","🎯","🎒","📚","🎵","😅","🤝","🌈","🐯","🦅","🐢","🐼","🦊","🧩","🪄","🍀","🪵","⭐","🎮","📸","🎧","🛹","🪐"];
function emojiForIndex(i){ return cycleEmojis[i % cycleEmojis.length]; }

function makeIGUrl(handle){
  // Try to create a usable Instagram URL, URL-encode the handle.
  const cleaned = encodeURIComponent(handle.replace(/\s+/g,''));
  return `https://instagram.com/${cleaned}`;
}

/* ======== Render functions ======== */
function renderMembers(){
  const container = document.getElementById('membersGrid');
  container.innerHTML = '';
  const saved = loadSaved('membersContent');
  const list = saved || membersArr;
  list.forEach((name,i)=>{
    const el = document.createElement('div');
    el.className = 'member';
    el.innerHTML = `
      <div class="avatar" title="${name}">${emojiForIndex(i)}</div>
      <div>
        <div class="name">${name}</div>
        <div class="muted">Class member #${i+1}</div>
      </div>
    `;
    container.appendChild(el);
  });
}

function renderTeachers(){
  const container = document.getElementById('teachersGrid');
  container.innerHTML = '';
  const saved = loadSaved('teachersContent');
  const list = saved || teachersArr;
  list.forEach((name,i)=>{
    const el = document.createElement('div');
    el.className = 'member';
    el.innerHTML = `
      <div class="avatar">🎓</div>
      <div>
        <div class="name">${name}</div>
        <div class="muted">Teacher</div>
      </div>
    `;
    container.appendChild(el);
  });
}

function renderNicknames(){
  const container = document.getElementById('nickList');
  container.innerHTML = '';
  const saved = loadSaved('nicknamesContent');
  const list = saved || nicknamesArr;
  const ol = document.createElement('ol');
  list.forEach(item=>{
    const li = document.createElement('li');
    li.style.marginBottom='6px';
    li.textContent = item;
    ol.appendChild(li);
  });
  container.appendChild(ol);
}

function renderIGs(){
  const container = document.getElementById('igList');
  container.innerHTML = '';
  const saved = loadSaved('instaContent');
  const list = saved || igAccounts;
  list.forEach((ent)=>{
    const a = document.createElement('a');
    a.className='ig-item';
    a.href = makeIGUrl(ent.handle);
    a.target='_blank';
    a.innerHTML = `
      <div class="ig-badge">IG</div>
      <div>
        <div style="font-weight:700">${ent.display}</div>
        <div class="small">@${ent.handle}</div>
      </div>
    `;
    container.appendChild(a);
  });
}

/* ======== Local Storage for edits ======== */
function saveToLocal(key, value){
  try { localStorage.setItem('thee_'+key, JSON.stringify(value)); } catch(e){ console.warn('save failed',e); }
}
function loadSaved(key){
  try {
    const raw = localStorage.getItem('thee_'+key);
    if(!raw) return null;
    return JSON.parse(raw);
  } catch(e){ return null; }
}
function clearSaved(){
  ['membersContent','teachersContent','nicknamesContent','instaContent','classgeesContent','keythingsContent','memesContent','backbenchContent','aboutContent'].forEach(k=>{
    localStorage.removeItem('thee_'+k);
  });
  location.reload();
}

/* ======== Visitor Counter (per-browser) ======== */
function incrementVisit(){
  try {
    const key = 'thee_visitCount';
    const raw = localStorage.getItem(key);
    let n = raw ? parseInt(raw||'0',10) : 0;
    n = n+1;
    localStorage.setItem(key, String(n));
    document.getElementById('visitCount').textContent = 'Visits: ' + n;
    document.getElementById('visitorNote').textContent = 'Visitor counter (this browser only).';
  } catch(e){
    document.getElementById('visitCount').textContent = 'Visits: 1';
  }
}

/* ======== Settings & Edit Mode ======== */
let unlocked = false;
let editMode = false;

function openSettings(){
  document.getElementById('settingsPanel').classList.remove('hidden');
  document.getElementById('settingsPanel').setAttribute('aria-hidden','false');
  document.getElementById('pwInput').focus();
}
function closeSettings(){
  document.getElementById('settingsPanel').classList.add('hidden');
  document.getElementById('settingsPanel').setAttribute('aria-hidden','true');
}

function enableEditMode(on){
  editMode = !!on;
  document.getElementById('toggleEdit').textContent = editMode ? 'Disable Edit Mode' : 'Enable Edit Mode';
  const editableSelectors = ['members','teachers','nicknames','insta','classgees','keythings','memes','backbench','about'];
  editableSelectors.forEach(id=>{
    const sec = document.getElementById(id);
    if(!sec) return;
    if(editMode){
      sec.setAttribute('contenteditable','true');
      sec.style.outline = '2px dashed rgba(139,92,246,0.14)';
    } else {
      sec.removeAttribute('contenteditable');
      sec.style.outline = 'none';
    }
  });
}

function saveEdits(){
  // Save inner content of sections to localStorage
  const keys = document.querySelectorAll('[data-key]');
  keys.forEach(node=>{
    const key = node.getAttribute('data-key');
    // Save structured data for members/teachers/insta/nicknames where appropriate
    try {
      if(key === 'membersContent'){
        // save as simple array of names by reading children .name
        const arr = Array.from(node.querySelectorAll('.member .name')).map(n=>n.textContent);
        saveToLocal(key, arr.length ? arr : membersArr);
      } else if(key === 'teachersContent'){
        const arr = Array.from(node.querySelectorAll('.member .name')).map(n=>n.textContent);
        saveToLocal(key, arr.length ? arr : teachersArr);
      } else if(key === 'nicknamesContent'){
        const arr = Array.from(node.querySelectorAll('ol li')).map(n=>n.textContent);
        if(arr.length) saveToLocal(key, arr);
      } else if(key === 'instaContent'){
        // For insta, try to parse rows
        const rows = Array.from(node.querySelectorAll('.ig-item'));
        if(rows.length){
          const parsed = rows.map(r=>{
            const display = r.querySelector('div:nth-child(2) > div')?.textContent || '';
            const handle = r.querySelector('.small')?.textContent?.replace('@','') || '';
            return {display:display, handle:handle};
          });
          saveToLocal(key, parsed);
        }
      } else {
        // Generic: save innerHTML
        saveToLocal(key, node.innerHTML);
      }
    } catch(e){
      console.warn('saveEdits error', e);
    }
  });
  alert('Saved edits locally to this browser.');
  // re-render to ensure consistent UI
  renderAll();
}

function revertOriginal(){
  if(!confirm('Revert this page to original built-in content? This will NOT remove edits saved to your browser (use "Clear Saved Edits" to remove saved).')) return;
  renderAll(true);
}

/* ======== Init & Binding ======== */
function renderAll(useDefaults=false){
  // If useDefaults true, ignore saved data
  // Render members
  if(useDefaults) {
    localStorage.removeItem('thee_membersContent');
    localStorage.removeItem('thee_teachersContent');
    localStorage.removeItem('thee_nicknamesContent');
    localStorage.removeItem('thee_instaContent');
  }
  // For small sections, if saved content is HTML string, keep it (but prefer arrays above)
  renderMembers();
  renderTeachers();
  renderNicknames();
  renderIGs();
  // If saved HTML for other sections, apply
  ['classgeesContent','keythingsContent','memesContent','backbenchContent','aboutContent'].forEach(k=>{
    const node = document.querySelector(`[data-key="${k}"]`);
    if(!node) return;
    const saved = loadSaved(k);
    if(saved){
      // if it's a string (HTML) set it
      if(typeof saved === 'string') node.innerHTML = saved;
      else if(Array.isArray(saved)) node.innerHTML = saved.join('<br>');
      // else ignore
    }
  });
}

/* ======== Password unlock ======== */
document.getElementById('settingsBtn').addEventListener('click', openSettings);
document.getElementById('closeSettings').addEventListener('click', closeSettings);
document.getElementById('pwCancel').addEventListener('click', closeSettings);
document.getElementById('pwUnlock').addEventListener('click', ()=>{
  const v = document.getElementById('pwInput').value || '';
  const msg = document.getElementById('pwMessage');
  if(v === 'MATRIX'){
    unlocked = true;
    document.getElementById('pwBox').classList.add('hidden');
    document.getElementById('editBox').classList.remove('hidden');
    msg.textContent = 'Unlocked — you can enable Edit Mode.';
    msg.style.color = 'lightgreen';
  } else {
    msg.textContent = 'Wrong password.';
    msg.style.color = '#ff6b6b';
  }
});

document.getElementById('toggleEdit').addEventListener('click', ()=>{
  if(!unlocked){ alert('Enter password MATRIX first.'); return; }
  enableEditMode(!editMode);
});

document.getElementById('saveEdits').addEventListener('click', ()=>{
  if(!unlocked){ alert('Enter password MATRIX first.'); return; }
  saveEdits();
});

document.getElementById('revertEdits').addEventListener('click', ()=>{
  if(!unlocked){ alert('Enter password MATRIX first.'); return; }
  revertOriginal();
});

document.getElementById('clearLocal').addEventListener('click', ()=>{
  if(!confirm('Clear all saved edits from this browser? This cannot be undone.')) return;
  clearSaved();
});

document.getElementById('gotoTop').addEventListener('click', ()=> window.scrollTo({top:0,behavior:'smooth'}));

/* ======== On load ======== */
incrementVisit();
renderAll();

/* If saved instaContent was structured array, try to re-render using it */
(function tryLoadCustomInsta(){
  const saved = loadSaved('instaContent');
  if(saved && Array.isArray(saved) && saved.length && typeof saved[0] === 'object'){
    // Overwrite igAccounts for display
    igAccounts.length = 0;
    saved.forEach(s=>{
      igAccounts.push({display: s.display || s.handle, handle: (s.handle||'').replace(/^@/,'')});
    });
    renderIGs();
  }
})();

/* Smooth scrolling for TOC */
document.querySelectorAll('.toc a').forEach(a=>{
  a.addEventListener('click', (e)=>{
    e.preventDefault();
    const id = a.getAttribute('href').slice(1);
    const el = document.getElementById(id);
    if(el) el.scrollIntoView({behavior:'smooth', block:'start'});
  });
});

/* Allow pressing Enter to unlock password */
document.getElementById('pwInput').addEventListener('keypress', (e)=>{
  if(e.key === 'Enter') document.getElementById('pwUnlock').click();
});
</script>
</body>
</html>
